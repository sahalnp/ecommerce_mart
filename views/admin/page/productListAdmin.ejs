<!DOCTYPE html>
<html class="loading" lang="en" data-textdirection="ltr">
 
        <%- include('../partials/header') %>
    <head>  
    </head>
        <%- include('../partials/navbar') %>

        <div class="app-content content " >
            <div class="content-overlay"></div>
            <div class="content-wrapper"  style="margin-top: 50px;">
                <div class="content-header row">
                    <div class="content-header-left col-md-12 mb-3">
                        <h3 class="content-header-title text-dark " style="margin-top:-10px">
                            All Products
                        </h3>
                    </div>
                </div>

                <div class="content-body" >
                    <% if (products.length === 0) { %>
                    <div class="alert alert-info">No products found.</div>
                    <% } else { %>
                    <div class="table-responsive">
                        <table
                            class="table table-bordered table-hover text-center align-middle"
                        >
                            <thead class="bg-dark text-white">
                                <tr>
                                    <th>#</th>
                                    <th>Image</th>
                                    <th>Name</th>
                                    <th>Price</th>
                                    <th>Status</th>
                                    <th>In Stock</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% products.forEach((product, index) => { %>
                                <tr>
                                    <td><%= index + 1 %></td>
                                    <td>
                                        <img
                                            src="<%= product.image[0]?.filepath %>"
                                            style="
                                                max-width: 75px;
                                                max-height: 75px;
                                            "
                                            alt="Product Image"
                                        />
                                    </td>
                                    <td class="text-dark">
                                        <%= product.title %>
                                        </td>
                                        <td class="text-dark">
                                            â‚¹<%= product.pricing?.salePrice ?
                                            product.pricing.salePrice.toFixed(2) :
                                            (product.pricing?.price ?
                                            product.pricing.price.toFixed(2) :
                                            '0.00') %>
                                        </td>
                                        

                                        <td>
                                            <form action="/admin/product/listing/<%= product._id %>" method="POST">
                                                <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                                                <select name="isListed" 
                                                        class="form-select form-select-sm <%= product.isListed ? 'bg-primary text-white' : 'bg-danger text-white' %>" 
                                                        onchange="this.form.submit()">
                                                    <option value="true" <%= product.isListed ? 'selected' : '' %>>Listed</option>
                                                    <option value="false" <%= !product.isListed ? 'selected' : '' %>>Unlisted</option>
                                                </select>
                                            </form>
                                        </td>
                                        
                                        
                                    <td class="text-dark">
                                        <%= product.inStock || 0 %>
                                    </td>
                                    <td>
                                        <div
                                            class="d-flex justify-content-center gap-2"
                                        >
                                            <a
                                                href="/admin/product/edit/<%= product._id %>"
                                                class="btn btn-sm btn-outline-primary me-2"
                                            >
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            
                                        </div>
                                    </td>
                                </tr>
                                <% }) %>
                            </tbody>
                        </table>
                    </div>
                    <% } %>
                </div>
            </div>
        </div>
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                document.querySelectorAll('select[name="isListed"]').forEach(select => {
                    select.addEventListener('change', function () {
                        if (this.value === 'true') {
                            this.classList.remove('bg-danger');
                            this.classList.add('bg-primary', 'text-white');
                        } else {
                            this.classList.remove('bg-primary');
                            this.classList.add('bg-danger', 'text-white');
                        }
                    });
                });
            });
        </script>
        
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="/admin/theme-assets/vendors/js/vendors.min.js"></script>
        <script src="/admin/theme-assets/js/core/app-menu-lite.js"></script>
        <script src="/admin/theme-assets/js/core/app-lite.js"></script>
        <%- include('../partials/footer') %>

