<%- include('partials/header') %>

<div class="container d-flex justify-content-center align-items-center vh-100">
    <div class="card p-4 shadow-lg text-center" style="max-width: 400px; width: 100%;">
        <h2 class="mb-3">OTP Verification</h2>
        <p class="text-muted fw">Enter the OTP sent to your email.</p>

        <% if (error) { %>
            <div class="alert alert-danger" role="alert">
                <%= error %>
            </div>
        <% } %>

        <form action="/otp" method="POST">
            <div class="mb-3">
                <input type="text" name="otp" class="form-control text-center" placeholder="Enter OTP" required>
            </div>
            <button type="submit" class="btn btn-primary w-100">Verify OTP</button>
        </form>

        <div class="mt-3 d-flex align-items-center justify-content-center">
            <span id="timer" class="text-muted <%= (!time || time <= 0) ? 'd-none' : '' %>">
                Resend OTP in <%= time %>s
            </span>
        </div>

        <a href="/otp" id="resendBtn" class="btn btn-link p-0 text-primary <%= (time && time > 0) ? 'd-none' : '' %>">
            Resend OTP
        </a>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const timerSpan = document.getElementById("timer");
        const resendBtn = document.getElementById("resendBtn");
        let timeLeft = <%= time || 60 %>; // Make sure time starts at 60 if not set

        // Debugging: Check initial timeLeft
        console.log('Initial timeLeft:', timeLeft);

        function updateTimer() {
            if (timeLeft > 0) {
                timerSpan.textContent = `Resend OTP in ${timeLeft}s`;
                timeLeft--;
                setTimeout(updateTimer, 1000);
            } else {
                // Hide the timer and show the resend button when time is up
                timerSpan.classList.add("d-none");
                resendBtn.classList.remove("d-none");
            }
        }

        // If there's time left, start the countdown
        if (timeLeft > 0) {
            updateTimer();
        } else {
            // If time is already 0, hide the timer and show the resend button immediately
            timerSpan.classList.add("d-none");
            resendBtn.classList.remove("d-none");
        }
    });
</script>

<%- include('partials/footer') %>
