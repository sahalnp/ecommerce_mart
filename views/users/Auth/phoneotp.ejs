<%- include('../partials/authHeader') %>


<div class="container d-flex justify-content-center align-items-center vh-100">
    <div class="card p-4 shadow-lg text-center" style="max-width: 400px; width: 100%;">
        <h2 class="mb-3">Enter OTP</h2>
        <p class="text-muted fw">We have sent an OTP to your phone number: <strong><%= phone %></strong></p>

        <% if (error) { %>
            <div class="alert alert-danger" role="alert">
                <%= error %>
            </div>
        <% } %>

        <form action="/phoneotp" method="POST">
             <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <div class="mb-3">
                <input type="text" name="otp" class="form-control text-center" placeholder="Enter OTP" required>
            </div>
            <button class="btn btn-primary w-100 mt-3">Verify OTP</button>
        </form>

        <% if (time !== null) { %>
            <div class="mt-3 d-flex align-items-center justify-content-center">
                <span id="timer" class="text-muted">Resend OTP in <%= time %>s</span>
            </div>
            <a href="/phoneotp" id="resendBtn" class="btn btn-link p-0 text-primary d-none">Resend OTP</a>
        <% } else { %>
            <a href="/phoneotp" id="resendBtn" class="btn btn-link p-0 text-primary">Resend OTP</a>
        <% } %>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        let timerSpan = document.getElementById("timer");
        let resendBtn = document.getElementById("resendBtn");
        let timeLeft = 60;

        function updateTimer() {
            if (timeLeft > 0) {
                timerSpan.textContent = `Resend OTP in ${timeLeft}s`;
                timeLeft--;
                setTimeout(updateTimer, 1000);
            } else {
                timerSpan.style.display = "none"; // Hide timer
                resendBtn.classList.remove("d-none"); // Show Resend OTP button
            }
        }

        if (timeLeft <= 0) {
            timerSpan.style.display = "none"; // Hide timer immediately
            resendBtn.classList.remove("d-none"); // Show Resend OTP button immediately
        } else {
            updateTimer(); // Start the countdown
        }
    });
</script>

<%- include('../partials/authFooter') %>
